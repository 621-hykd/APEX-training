<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä½“æµ‹é€š</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            background-attachment: fixed;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            text-align: center;
            padding: 40px 30px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 20"><defs><radialGradient id="a" cx="50%" cy="40%"><stop offset="0%" stop-color="white" stop-opacity="0.3"/><stop offset="100%" stop-color="white" stop-opacity="0"/></radialGradient></defs><rect width="100" height="20" fill="url(%23a)"/></svg>');
            opacity: 0.3;
        }

        .header h1 {
            font-size: 2.8em;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .form-section {
            padding: 40px;
        }

        .form-group {
            margin-bottom: 30px;
            position: relative;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #2d3748;
            font-size: 15px;
            transition: color 0.3s ease;
        }

        input, select {
            width: 100%;
            padding: 15px 18px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #f7fafc;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        input:focus, select:focus {
            outline: none;
            border-color: #4facfe;
            background: white;
            box-shadow: 0 0 0 4px rgba(79, 172, 254, 0.15), 0 8px 25px rgba(79, 172, 254, 0.2);
            transform: translateY(-2px);
        }

        .radio-group {
            display: flex;
            gap: 25px;
            margin-top: 10px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 12px 18px;
            border-radius: 10px;
            transition: all 0.3s ease;
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            flex: 1;
            text-align: center;
        }

        .radio-option:hover {
            background: #edf2f7;
            border-color: #cbd5e0;
            transform: translateY(-1px);
        }

        .radio-option input[type="radio"] {
            width: auto;
            margin-right: 10px;
            transform: scale(1.2);
        }

        .radio-option input[type="radio"]:checked + span {
            color: #4facfe;
            font-weight: 600;
        }

        .radio-option:has(input[type="radio"]:checked) {
            border-color: #4facfe;
            background: #f0f8ff;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.2);
        }

        .section-title {
            font-size: 1.4em;
            color: #2d3748;
            margin-bottom: 25px;
            padding-bottom: 12px;
            border-bottom: 3px solid #4facfe;
            display: flex;
            align-items: center;
            font-weight: 700;
        }

        .section-title::before {
            content: '';
            width: 10px;
            height: 10px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border-radius: 50%;
            margin-right: 12px;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.3);
        }

        .btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 18px 40px;
            font-size: 17px;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 8px 20px rgba(79, 172, 254, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(79, 172, 254, 0.4);
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .results {
            display: none;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            margin: 20px 30px 30px;
            padding: 40px;
            border-radius: 20px;
            border: 2px solid rgba(233, 236, 239, 0.5);
            box-shadow: 0 15px 35px rgba(0,0,0,0.08);
            backdrop-filter: blur(10px);
        }

        .results.show {
            display: block;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .score-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .score-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            text-align: center;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
            border: 2px solid transparent;
        }

        .score-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            transform: scaleX(0);
            transition: transform 0.4s ease;
        }

        .score-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
            border-color: rgba(79, 172, 254, 0.3);
        }

        .score-card:hover::before {
            transform: scaleX(1);
        }

        .score-title {
            font-size: 16px;
            color: #2d3748;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .score-value {
            font-size: 2.5em;
            font-weight: 700;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 8px;
            position: relative;
        }

        .score-level {
            padding: 6px 16px;
            border-radius: 25px;
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .level-excellent { background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%); color: white; }
        .level-good { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; }
        .level-pass { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; }
        .level-fail { background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%); color: white; }

        .total-score {
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 35px;
            border-radius: 18px;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3);
        }

        .total-score h3 {
            font-size: 1.4em;
            margin-bottom: 15px;
            opacity: 0.9;
            font-weight: 600;
        }

        .total-score .score {
            font-size: 4em;
            font-weight: bold;
            margin-bottom: 15px;
            position: relative;
            display: inline-block;
        }

        .total-score .score::after {
            content: 'åˆ†';
            font-size: 0.4em;
            position: absolute;
            top: 10px;
            right: -50px;
            color: rgba(255,255,255,0.8);
        }

        .suggestions {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border: 2px solid rgba(79, 172, 254, 0.1);
        }

        .suggestions h4 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            font-weight: 700;
        }

        .suggestions h4::before {
            content: 'ğŸ’¡';
            margin-right: 12px;
            font-size: 1.4em;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        .suggestion-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            border-left: 6px solid #4facfe;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .suggestion-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(79, 172, 254, 0.05) 0%, transparent 50%);
            z-index: 1;
        }

        .suggestion-item:hover {
            transform: translateX(8px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .suggestion-item::after {
            content: 'ğŸ’¡';
            margin-right: 12px;
            font-size: 18px;
            position: relative;
            z-index: 2;
        }

        .error {
            color: #dc3545;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }

        .error.show {
            display: block;
            animation: shake 0.5s ease;
        }

        .error-message {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #f5c6cb;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            box-shadow: 0 8px 20px rgba(220, 53, 69, 0.15);
            position: relative;
            overflow: hidden;
            font-weight: 500;
        }

        .error-message::before {
            content: 'âš ï¸';
            margin-right: 12px;
            font-size: 1.4em;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        .error-message::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(220, 53, 69, 0.05) 0%, transparent 50%);
            z-index: 1;
        }

        .input-error {
            border-color: #dc3545 !important;
            background-color: #fff5f5 !important;
            box-shadow: 0 0 0 4px rgba(220, 53, 69, 0.15) !important;
        }

        .input-success {
            border-color: #28a745 !important;
            background-color: #f0fff4 !important;
            box-shadow: 0 0 0 4px rgba(40, 167, 69, 0.15) !important;
        }

        .validation-message {
            font-size: 13px;
            margin-top: 6px;
            padding: 8px 12px;
            border-radius: 6px;
            display: none;
            font-weight: 500;
        }

        .validation-message.error {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            display: block;
            border: 1px solid #f5c6cb;
        }

        .validation-message.success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            display: block;
            border: 1px solid #c3e6cb;
        }

        .input-group {
            position: relative;
        }

        .input-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2em;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .input-icon.show {
            opacity: 1;
        }

        .input-icon.success {
            color: #28a745;
        }

        .input-icon.error {
            color: #dc3545;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4facfe;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            .form-section {
                padding: 20px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        /* è®­ç»ƒè®¡åˆ’æ ·å¼ */
        .training-plan-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .training-phase {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            backdrop-filter: blur(10px);
        }

        .day-training-item {
            background: rgba(255,255,255,0.95);
            color: #2d3748;
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
            border-left: 4px solid #4facfe;
            transition: all 0.3s ease;
        }

        .day-training-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .rest-day-item {
            background: rgba(72,187,120,0.1);
            border-left-color: #48bb78;
        }

        .training-action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            justify-content: center;
        }

        .training-action-buttons button {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .training-action-buttons button:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸƒâ€â™‚ï¸ ä½“æµ‹é€š</h1>
            <p>ä¸ªæ€§åŒ–ä½“æµ‹è®­ç»ƒè§„åˆ’åŠ©æ‰‹
                By Teamè·ƒåŠ¨å¼•æ“</p>
        </div>

        <div class="form-section">
            <div class="section-title">åŸºæœ¬ä¿¡æ¯</div>
            <div class="form-row">
                <div class="form-group">
                    <label>æ€§åˆ« *</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="gender" value="male" required>
                            <span>ç”·ç”Ÿ</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="gender" value="female" required>
                            <span>å¥³ç”Ÿ</span>
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="age">å¹´é¾„ *</label>
                    <input type="number" id="age" name="age" min="18" max="25" required>
                    <div class="error" id="age-error"></div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="height">èº«é«˜ (cm) *</label>
                    <input type="number" id="height" name="height" min="140" max="220" step="0.1" required>
                    <div class="error" id="height-error"></div>
                </div>
                <div class="form-group">
                    <label for="weight">ä½“é‡ (kg) *</label>
                    <input type="number" id="weight" name="weight" min="30" max="150" step="0.1" required>
                    <div class="error" id="weight-error"></div>
                </div>
            </div>

            <div class="section-title">ä½“æµ‹é¡¹ç›®</div>
            <div class="form-row">
                <div class="form-group">
                    <label for="lungCapacity">è‚ºæ´»é‡ (ml) *</label>
                    <input type="number" id="lungCapacity" name="lungCapacity" min="1000" max="8000" required>
                    <div class="error" id="lungCapacity-error"></div>
                </div>
                <div class="form-group">
                    <label for="sitAndReach">åä½ä½“å‰å±ˆ (cm) *</label>
                    <input type="number" id="sitAndReach" name="sitAndReach" min="-30" max="50" step="0.1" required>
                    <div class="error" id="sitAndReach-error"></div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="enduranceRun">1000ç±³è·‘(ç”·)/800ç±³è·‘(å¥³) (åˆ†:ç§’) *</label>
                    <input type="text" id="enduranceRun" name="enduranceRun" placeholder="ä¾‹å¦‚: 4:30" required>
                    <div class="error" id="enduranceRun-error"></div>
                </div>
                <div class="form-group" id="strengthGroup">
                    <label for="strengthTest">å¼•ä½“å‘ä¸Š(ç”·)/ä»°å§èµ·å(å¥³) (æ¬¡) *</label>
                    <input type="number" id="strengthTest" name="strengthTest" min="0" max="100" required>
                    <div class="error" id="strengthTest-error"></div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="standingJump">ç«‹å®šè·³è¿œ (cm) *</label>
                    <input type="number" id="standingJump" name="standingJump" min="100" max="400" required>
                    <div class="error" id="standingJump-error"></div>
                </div>
                <div class="form-group">
                    <label for="sprint50">50ç±³è·‘ (ç§’) *</label>
                    <input type="number" id="sprint50" name="sprint50" min="5" max="20" step="0.01" required>
                    <div class="error" id="sprint50-error"></div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button type="button" class="btn" onclick="calculateScores()">ğŸ§® è®¡ç®—æˆç»©</button>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>æ­£åœ¨è®¡ç®—æˆç»©...</p>
            </div>
        </div>

        <div class="results" id="results">
            <div class="total-score">
                <h3>æ€»æˆç»©</h3>
                <div class="score" id="totalScore">0</div>
                <div class="score-level level-good" id="totalLevel">è‰¯å¥½</div>
            </div>

            <div class="score-grid" id="scoreGrid">
                <!-- å•é¡¹æˆç»©å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>

            <div class="suggestions">
                <h4>ğŸ’¡ æ”¹è¿›å»ºè®®</h4>
                <div id="suggestionsList">
                    <!-- å»ºè®®å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button type="button" class="btn" onclick="showTrainingPlanSection()">ğŸ¯ åˆ¶å®šè®­ç»ƒè®¡åˆ’</button>
            </div>
        </div>

        <!-- ç›®æ ‡è®¾å®šå’Œè®­ç»ƒè®¡åˆ’éƒ¨åˆ† -->
        <div class="form-section" id="trainingPlanSection" style="display: none;">
            <div class="section-title">ğŸ¯ ç›®æ ‡è®¾å®š</div>
            <div class="form-row">
                <div class="form-group">
                    <label for="targetScore">ç›®æ ‡æ€»æˆç»© (åˆ†)</label>
                    <input type="number" id="targetScore" name="targetScore" min="60" max="100" placeholder="ä¾‹å¦‚: 85">
                    <div class="error" id="targetScore-error"></div>
                </div>
                <div class="form-group">
                    <label for="examDays">è·ç¦»è€ƒè¯• (å¤©)</label>
                    <input type="number" id="examDays" name="examDays" min="7" max="365" placeholder="ä¾‹å¦‚: 30">
                    <div class="error" id="examDays-error"></div>
                </div>
            </div>

            <div class="section-title">ğŸ“Š å„é¡¹ç›®æ ‡æˆç»©</div>
            <div class="form-row">
                <div class="form-group">
                    <label for="targetLungCapacity">ç›®æ ‡è‚ºæ´»é‡ (ml)</label>
                    <input type="number" id="targetLungCapacity" name="targetLungCapacity" min="1000" max="8000">
                </div>
                <div class="form-group">
                    <label for="targetSitAndReach">ç›®æ ‡åä½ä½“å‰å±ˆ (cm)</label>
                    <input type="number" id="targetSitAndReach" name="targetSitAndReach" min="-30" max="50" step="0.1">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="targetEnduranceRun">ç›®æ ‡è€åŠ›è·‘ (åˆ†:ç§’)</label>
                    <input type="text" id="targetEnduranceRun" name="targetEnduranceRun" placeholder="ä¾‹å¦‚: 4:00">
                </div>
                <div class="form-group">
                    <label for="targetStrengthTest">ç›®æ ‡åŠ›é‡æµ‹è¯• (æ¬¡)</label>
                    <input type="number" id="targetStrengthTest" name="targetStrengthTest" min="0" max="100">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="targetStandingJump">ç›®æ ‡ç«‹å®šè·³è¿œ (cm)</label>
                    <input type="number" id="targetStandingJump" name="targetStandingJump" min="100" max="400">
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button type="button" class="btn" onclick="generateTrainingPlan()">ğŸƒâ€â™‚ï¸ ç”Ÿæˆè®­ç»ƒè®¡åˆ’</button>
            </div>

            <div class="loading" id="trainingLoading" style="display: none;">
                <div class="spinner"></div>
                <p>æ­£åœ¨ç”Ÿæˆä¸ªæ€§åŒ–è®­ç»ƒæ–¹æ¡ˆ...</p>
            </div>
        </div>

        <!-- è®­ç»ƒè®¡åˆ’ç»“æœæ˜¾ç¤º -->
        <div class="results" id="trainingResults" style="display: none;">
            <div class="total-score">
                <h3>ğŸ“… ä¸ªæ€§åŒ–è®­ç»ƒè®¡åˆ’</h3>
                <div id="trainingPlanSummary"></div>
            </div>

            <div id="trainingPlanDetails">
                <!-- è®­ç»ƒè®¡åˆ’è¯¦ç»†å†…å®¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button type="button" class="btn" onclick="exportTrainingPlan()">ğŸ“¥ å¯¼å‡ºè®­ç»ƒè®¡åˆ’</button>
                <button type="button" class="btn" onclick="printTrainingPlan()" style="margin-left: 15px;">ğŸ–¨ï¸ æ‰“å°è®¡åˆ’</button>
                <button type="button" class="btn" onclick="showTrainingPlanHistory()" style="margin-left: 15px;">ğŸ“š å†å²è®°å½•</button>
            </div>
        </div>
    </div>

    <script>
        // è¯„åˆ†æ ‡å‡†æ•°æ® - ä¸¥æ ¼æŒ‰ç…§ã€Šå›½å®¶å­¦ç”Ÿä½“è´¨å¥åº·æ ‡å‡†ã€‹(2014å¹´ä¿®è®¢)
        const scoreStandards = {
            // BMIæ ‡å‡† (18-22å²) - å¤§å­¦é˜¶æ®µ
            bmi: {
                male: {
                    excellent: { min: 17.9, max: 23.9, score: 100 },  // æ­£å¸¸èŒƒå›´
                    good: { min: 24.0, max: 27.9, score: 80 },      // è¶…é‡
                    pass: { min: 28.0, max: 32.9, score: 60 },      // è‚¥èƒ–
                    fail: { min: 0, max: 17.8, score: 40 }          // åç˜¦
                },
                female: {
                    excellent: { min: 17.2, max: 23.9, score: 100 }, // æ­£å¸¸èŒƒå›´
                    good: { min: 24.0, max: 27.9, score: 80 },       // è¶…é‡
                    pass: { min: 28.0, max: 32.9, score: 60 },       // è‚¥èƒ–
                    fail: { min: 0, max: 17.1, score: 40 }             // åç˜¦
                }
            },
            // è‚ºæ´»é‡æ ‡å‡† (ml) - å¤§å­¦é˜¶æ®µ(18-22å²)
            lungCapacity: {
                male: {
                    18: { excellent: 5040, good: 4540, pass: 3300, fail: 2300 },
                    19: { excellent: 5140, good: 4640, pass: 3400, fail: 2400 },
                    20: { excellent: 5240, good: 4740, pass: 3500, fail: 2500 },
                    21: { excellent: 5340, good: 4840, pass: 3600, fail: 2600 },
                    22: { excellent: 5440, good: 4940, pass: 3700, fail: 2700 }
                },
                female: {
                    18: { excellent: 3340, good: 2940, pass: 2050, fail: 1500 },
                    19: { excellent: 3440, good: 3040, pass: 2150, fail: 1600 },
                    20: { excellent: 3540, good: 3140, pass: 2250, fail: 1700 },
                    21: { excellent: 3640, good: 3240, pass: 2350, fail: 1800 },
                    22: { excellent: 3740, good: 3340, pass: 2450, fail: 1900 }
                }
            },
            // åä½ä½“å‰å±ˆæ ‡å‡† (cm) - å¤§å­¦é˜¶æ®µ
            sitAndReach: {
                male: {
                    excellent: { min: 19.2, score: 100 },  // ä¼˜ç§€
                    good: { min: 12.8, score: 80 },       // è‰¯å¥½
                    pass: { min: 6.0, score: 60 },        // åŠæ ¼
                    fail: { min: -30, score: 40 }          // ä¸åŠæ ¼
                },
                female: {
                    excellent: { min: 19.3, score: 100 },  // ä¼˜ç§€
                    good: { min: 13.8, score: 80 },       // è‰¯å¥½
                    pass: { min: 7.5, score: 60 },        // åŠæ ¼
                    fail: { min: -30, score: 40 }          // ä¸åŠæ ¼
                }
            },
            // è€åŠ›è·‘æ ‡å‡† (ç§’) - 1000ç±³(ç”·)/800ç±³(å¥³)
            enduranceRun: {
                male: { // 1000ç±³
                    excellent: { max: 214, score: 100 }, // 3:34
                    good: { max: 234, score: 80 },      // 3:54
                    pass: { max: 259, score: 60 },      // 4:19
                    fail: { max: 330, score: 40 }      // 5:30
                },
                female: { // 800ç±³
                    excellent: { max: 194, score: 100 }, // 3:14
                    good: { max: 207, score: 80 },      // 3:27
                    pass: { max: 224, score: 60 },    // 3:44
                    fail: { max: 280, score: 40 }     // 4:40
                }
            },
            // 50ç±³çŸ­è·‘æ ‡å‡† (ç§’)
            sprint50: {
                male: {
                    excellent: { max: 7.2, score: 100 },
                    good: { max: 7.6, score: 80 },
                    pass: { max: 8.2, score: 60 },
                    fail: { max: 10.0, score: 40 }
                },
                female: {
                    excellent: { max: 8.5, score: 100 },
                    good: { max: 9.0, score: 80 },
                    pass: { max: 9.8, score: 60 },
                    fail: { max: 12.0, score: 40 }
                }
            },
            // åŠ›é‡æµ‹è¯•æ ‡å‡†
            strengthTest: {
                male: { // å¼•ä½“å‘ä¸Š
                    excellent: { min: 17, score: 100 },  // ä¼˜ç§€
                    good: { min: 15, score: 80 },       // è‰¯å¥½
                    pass: { min: 10, score: 60 },        // åŠæ ¼
                    fail: { min: 0, score: 40 }          // ä¸åŠæ ¼
                },
                female: { // ä»°å§èµ·å(1åˆ†é’Ÿ)
                    excellent: { min: 52, score: 100 },  // ä¼˜ç§€
                    good: { min: 46, score: 80 },       // è‰¯å¥½
                    pass: { min: 26, score: 60 },        // åŠæ ¼
                    fail: { min: 0, score: 40 }          // ä¸åŠæ ¼
                }
            },
            // ç«‹å®šè·³è¿œæ ‡å‡† (cm) - å¤§å­¦é˜¶æ®µ
            standingJump: {
                male: {
                    excellent: { min: 273, score: 100 },  // ä¼˜ç§€
                    good: { min: 263, score: 80 },       // è‰¯å¥½
                    pass: { min: 208, score: 60 },       // åŠæ ¼
                    fail: { min: 100, score: 40 }       // ä¸åŠæ ¼
                },
                female: {
                    excellent: { min: 207, score: 100 },  // ä¼˜ç§€
                    good: { min: 195, score: 80 },       // è‰¯å¥½
                    pass: { min: 151, score: 60 },       // åŠæ ¼
                    fail: { min: 100, score: 40 }       // ä¸åŠæ ¼
                }
            }
        };

        // å·¥å…·å‡½æ•°
        function timeToSeconds(timeStr) {
            const parts = timeStr.split(':');
            if (parts.length !== 2) return null;
            const minutes = parseInt(parts[0]);
            const seconds = parseInt(parts[1]);
            if (isNaN(minutes) || isNaN(seconds) || seconds >= 60) return null;
            return minutes * 60 + seconds;
        }

        function isValidTime(timeStr) {
            const timePattern = /^\d{1,2}:\d{2}$/;
            if (!timePattern.test(timeStr)) return false;
            const seconds = timeToSeconds(timeStr);
            return seconds !== null;
        }

        function getBMIScore(bmi, gender) {
            const standards = scoreStandards.bmi[gender];
            if (bmi >= standards.excellent.min && bmi <= standards.excellent.max) {
                return { score: 100, level: 'excellent' };
            } else if ((bmi >= standards.good.min && bmi <= standards.good.max) || 
                       (bmi >= 24.0 && bmi <= 27.9)) { // è¶…é‡èŒƒå›´
                return { score: 80, level: 'good' };
            } else if (bmi >= standards.pass.min && bmi <= standards.pass.max) {
                return { score: 60, level: 'pass' };
            } else {
                return { score: 40, level: 'fail' };
            }
        }

        function getSitAndReachScore(distance, gender) {
            const standards = scoreStandards.sitAndReach[gender];
            if (distance >= standards.excellent.min) {
                return { score: 100, level: 'excellent' };
            } else if (distance >= standards.good.min) {
                // åœ¨è‰¯å¥½åˆ°ä¼˜ç§€ä¹‹é—´çº¿æ€§æ’å€¼
                const score = linearInterpolation(distance, standards.good.min, 80, standards.excellent.min, 100);
                return { score, level: 'good' };
            } else if (distance >= standards.pass.min) {
                // åœ¨åŠæ ¼åˆ°è‰¯å¥½ä¹‹é—´çº¿æ€§æ’å€¼
                const score = linearInterpolation(distance, standards.pass.min, 60, standards.good.min, 80);
                return { score, level: 'pass' };
            } else {
                // åœ¨ä¸åŠæ ¼åˆ°åŠæ ¼ä¹‹é—´çº¿æ€§æ’å€¼ï¼Œæœ€ä½40åˆ†
                const score = Math.max(40, linearInterpolation(distance, standards.fail.min, 40, standards.pass.min, 60));
                return { score, level: 'fail' };
            }
        }

        function getEnduranceRunScore(seconds, gender) {
            const standards = scoreStandards.enduranceRun[gender];
            if (seconds <= standards.excellent.max) {
                return { score: 100, level: 'excellent' };
            } else if (seconds <= standards.good.max) {
                // åœ¨è‰¯å¥½åˆ°ä¼˜ç§€ä¹‹é—´çº¿æ€§æ’å€¼ï¼ˆæ—¶é—´è¶ŠçŸ­åˆ†æ•°è¶Šé«˜ï¼‰
                const score = linearInterpolation(seconds, standards.good.max, 80, standards.excellent.max, 100);
                return { score, level: 'good' };
            } else if (seconds <= standards.pass.max) {
                // åœ¨åŠæ ¼åˆ°è‰¯å¥½ä¹‹é—´çº¿æ€§æ’å€¼
                const score = linearInterpolation(seconds, standards.pass.max, 60, standards.good.max, 80);
                return { score, level: 'pass' };
            } else {
                // åœ¨ä¸åŠæ ¼åˆ°åŠæ ¼ä¹‹é—´çº¿æ€§æ’å€¼ï¼Œæœ€ä½40åˆ†
                const score = Math.max(40, linearInterpolation(seconds, standards.fail.max, 40, standards.pass.max, 60));
                return { score, level: 'fail' };
            }
        }

        // 50ç±³çŸ­è·‘è¯„åˆ†
        function getSprint50Score(seconds, gender) {
            const standards = scoreStandards.sprint50[gender];
            if (seconds <= standards.excellent.max) {
                return { score: 100, level: 'excellent' };
            } else if (seconds <= standards.good.max) {
                const score = linearInterpolation(seconds, standards.good.max, 80, standards.excellent.max, 100);
                return { score, level: 'good' };
            } else if (seconds <= standards.pass.max) {
                const score = linearInterpolation(seconds, standards.pass.max, 60, standards.good.max, 80);
                return { score, level: 'pass' };
            } else {
                const score = Math.max(40, linearInterpolation(seconds, standards.fail.max, 40, standards.pass.max, 60));
                return { score, level: 'fail' };
            }
        }

        function getStrengthTestScore(count, gender) {
            const standards = scoreStandards.strengthTest[gender];
            if (count >= standards.excellent.min) {
                return { score: 100, level: 'excellent' };
            } else if (count >= standards.good.min) {
                // åœ¨è‰¯å¥½åˆ°ä¼˜ç§€ä¹‹é—´çº¿æ€§æ’å€¼
                const score = linearInterpolation(count, standards.good.min, 80, standards.excellent.min, 100);
                return { score, level: 'good' };
            } else if (count >= standards.pass.min) {
                // åœ¨åŠæ ¼åˆ°è‰¯å¥½ä¹‹é—´çº¿æ€§æ’å€¼
                const score = linearInterpolation(count, standards.pass.min, 60, standards.good.min, 80);
                return { score, level: 'pass' };
            } else {
                // åœ¨ä¸åŠæ ¼åˆ°åŠæ ¼ä¹‹é—´çº¿æ€§æ’å€¼ï¼Œæœ€ä½40åˆ†
                const score = Math.max(40, linearInterpolation(count, standards.fail.min, 40, standards.pass.min, 60));
                return { score, level: 'fail' };
            }
        }

        function getStandingJumpScore(distance, gender) {
            const standards = scoreStandards.standingJump[gender];
            if (distance >= standards.excellent.min) {
                return { score: 100, level: 'excellent' };
            } else if (distance >= standards.good.min) {
                // åœ¨è‰¯å¥½åˆ°ä¼˜ç§€ä¹‹é—´çº¿æ€§æ’å€¼
                const score = linearInterpolation(distance, standards.good.min, 80, standards.excellent.min, 100);
                return { score, level: 'good' };
            } else if (distance >= standards.pass.min) {
                // åœ¨åŠæ ¼åˆ°è‰¯å¥½ä¹‹é—´çº¿æ€§æ’å€¼
                const score = linearInterpolation(distance, standards.pass.min, 60, standards.good.min, 80);
                return { score, level: 'pass' };
            } else {
                // åœ¨ä¸åŠæ ¼åˆ°åŠæ ¼ä¹‹é—´çº¿æ€§æ’å€¼ï¼Œæœ€ä½40åˆ†
                const score = Math.max(40, linearInterpolation(distance, standards.fail.min, 40, standards.pass.min, 60));
                return { score, level: 'fail' };
            }
        }

        // çº¿æ€§æ’å€¼å‡½æ•° - ç”¨äºç²¾ç¡®è®¡ç®—ä¸­é—´å€¼å¾—åˆ†
        function linearInterpolation(x, x1, y1, x2, y2) {
            if (x <= x1) return y1;
            if (x >= x2) return y2;
            return Math.round(y1 + (x - x1) * (y2 - y1) / (x2 - x1));
        }

        // è·å–ç²¾ç¡®è‚ºæ´»é‡å¾—åˆ†
        function getLungCapacityScore(capacity, gender, age) {
            const ageStandards = scoreStandards.lungCapacity[gender];
            const ageKey = Math.min(22, Math.max(18, Math.floor(age))); // é™åˆ¶åœ¨18-22å²èŒƒå›´å†…
            const standards = ageStandards[ageKey];
            
            if (capacity >= standards.excellent) {
                return { score: 100, level: 'excellent' };
            } else if (capacity >= standards.good) {
                // åœ¨è‰¯å¥½åˆ°ä¼˜ç§€ä¹‹é—´çº¿æ€§æ’å€¼
                const score = linearInterpolation(capacity, standards.good, 80, standards.excellent, 100);
                return { score, level: 'good' };
            } else if (capacity >= standards.pass) {
                // åœ¨åŠæ ¼åˆ°è‰¯å¥½ä¹‹é—´çº¿æ€§æ’å€¼
                const score = linearInterpolation(capacity, standards.pass, 60, standards.good, 80);
                return { score, level: 'pass' };
            } else {
                // åœ¨ä¸åŠæ ¼åˆ°åŠæ ¼ä¹‹é—´çº¿æ€§æ’å€¼ï¼Œæœ€ä½40åˆ†
                const score = Math.max(40, linearInterpolation(capacity, standards.fail, 40, standards.pass, 60));
                return { score, level: 'fail' };
            }
        }

        function getLevelText(level) {
            const levelMap = {
                'excellent': 'ä¼˜ç§€',
                'good': 'è‰¯å¥½',
                'pass': 'åŠæ ¼',
                'fail': 'ä¸åŠæ ¼'
            };
            return levelMap[level];
        }

        function getLevelClass(level) {
            return `level-${level}`;
        }

        function validateInput() {
            let isValid = true;
            const errors = document.querySelectorAll('.error');
            errors.forEach(error => error.classList.remove('show'));

            // éªŒè¯æ€§åˆ«
            const gender = document.querySelector('input[name="gender"]:checked');
            if (!gender) {
                alert('è¯·é€‰æ‹©æ€§åˆ«');
                isValid = false;
            }

            // éªŒè¯å¹´é¾„
            const age = document.getElementById('age').value;
            if (!age || age < 18 || age > 25) {
                document.getElementById('age-error').textContent = 'å¹´é¾„å¿…é¡»åœ¨18-25å²ä¹‹é—´';
                document.getElementById('age-error').classList.add('show');
                isValid = false;
            } else {
                clearFieldValidation('age');
            }

            // éªŒè¯èº«é«˜
            const height = document.getElementById('height').value;
            if (!height || height < 140 || height > 220) {
                document.getElementById('height-error').textContent = 'èº«é«˜å¿…é¡»åœ¨140-220cmä¹‹é—´';
                document.getElementById('height-error').classList.add('show');
                isValid = false;
            } else {
                clearFieldValidation('height');
            }

            // éªŒè¯ä½“é‡
            const weight = document.getElementById('weight').value;
            if (!weight || weight < 30 || weight > 150) {
                document.getElementById('weight-error').textContent = 'ä½“é‡å¿…é¡»åœ¨30-150kgä¹‹é—´';
                document.getElementById('weight-error').classList.add('show');
                isValid = false;
            } else {
                clearFieldValidation('weight');
            }

            // éªŒè¯è‚ºæ´»é‡
            const lungCapacity = document.getElementById('lungCapacity').value;
            if (!lungCapacity || lungCapacity < 1000 || lungCapacity > 8000) {
                document.getElementById('lungCapacity-error').textContent = 'è‚ºæ´»é‡å¿…é¡»åœ¨1000-8000mlä¹‹é—´';
                document.getElementById('lungCapacity-error').classList.add('show');
                isValid = false;
            } else {
                clearFieldValidation('lungCapacity');
            }

            // éªŒè¯åä½ä½“å‰å±ˆ
            const sitAndReach = document.getElementById('sitAndReach').value;
            if (sitAndReach === '' || sitAndReach < -30 || sitAndReach > 50) {
                document.getElementById('sitAndReach-error').textContent = 'åä½ä½“å‰å±ˆå¿…é¡»åœ¨-30åˆ°50cmä¹‹é—´';
                document.getElementById('sitAndReach-error').classList.add('show');
                isValid = false;
            } else {
                clearFieldValidation('sitAndReach');
            }

            // éªŒè¯è€åŠ›è·‘æ—¶é—´æ ¼å¼
            const enduranceRun = document.getElementById('enduranceRun').value;
            if (!isValidTime(enduranceRun)) {
                document.getElementById('enduranceRun-error').textContent = 'è¯·è¾“å…¥æ­£ç¡®çš„æ—¶é—´æ ¼å¼ï¼ˆå¦‚ï¼š4:30ï¼‰';
                document.getElementById('enduranceRun-error').classList.add('show');
                isValid = false;
            } else {
                const seconds = timeToSeconds(enduranceRun);
                if (seconds === null) {
                    document.getElementById('enduranceRun-error').textContent = 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ—¶é—´';
                    document.getElementById('enduranceRun-error').classList.add('show');
                    isValid = false;
                } else {
                    clearFieldValidation('enduranceRun');
                }
            }

            // éªŒè¯åŠ›é‡æµ‹è¯•
            const strengthTest = document.getElementById('strengthTest').value;
            if (!strengthTest || strengthTest < 0 || strengthTest > 100) {
                document.getElementById('strengthTest-error').textContent = 'æ¬¡æ•°å¿…é¡»åœ¨0-100ä¹‹é—´';
                document.getElementById('strengthTest-error').classList.add('show');
                isValid = false;
            } else {
                clearFieldValidation('strengthTest');
            }

            // éªŒè¯50ç±³è·‘
            const sprint50Val = document.getElementById('sprint50').value;
            if (!sprint50Val || sprint50Val < 5 || sprint50Val > 20) {
                document.getElementById('sprint50-error').textContent = '50ç±³è·‘å¿…é¡»åœ¨5-20ç§’ä¹‹é—´';
                document.getElementById('sprint50-error').classList.add('show');
                isValid = false;
            } else {
                clearFieldValidation('sprint50');
            }

            // éªŒè¯ç«‹å®šè·³è¿œ
            const standingJump = document.getElementById('standingJump').value;
            if (!standingJump || standingJump < 100 || standingJump > 400) {
                document.getElementById('standingJump-error').textContent = 'ç«‹å®šè·³è¿œå¿…é¡»åœ¨100-400cmä¹‹é—´';
                document.getElementById('standingJump-error').classList.add('show');
                isValid = false;
            } else {
                clearFieldValidation('standingJump');
            }

            return isValid;
        }

        function clearFieldValidation(fieldId) {
            const field = document.getElementById(fieldId);
            const formGroup = field.closest('.form-group') || field.closest('.input-group');
            
            field.classList.remove('input-error', 'input-success');
            
            const validationMsg = formGroup.querySelector('.validation-message');
            if (validationMsg) {
                validationMsg.remove();
            }
            
            const inputIcon = formGroup.querySelector('.input-icon');
            if (inputIcon) {
                inputIcon.remove();
            }
        }

        function calculateScores() {
            if (!validateInput()) {
                return;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('loading').classList.add('show');
            
            setTimeout(() => {
                // è·å–è¾“å…¥æ•°æ®
                const gender = document.querySelector('input[name="gender"]:checked').value;
                const age = parseInt(document.getElementById('age').value);
                const height = parseFloat(document.getElementById('height').value);
                const weight = parseFloat(document.getElementById('weight').value);
                const lungCapacity = parseInt(document.getElementById('lungCapacity').value);
                const sitAndReach = parseFloat(document.getElementById('sitAndReach').value);
                const enduranceRunTime = document.getElementById('enduranceRun').value;
                const strengthTest = parseInt(document.getElementById('strengthTest').value);
                const standingJump = parseInt(document.getElementById('standingJump').value);
                const sprint50 = parseFloat(document.getElementById('sprint50').value);

                // è®¡ç®—å„é¡¹æˆç»©
                const bmi = weight / Math.pow(height / 100, 2);
                const enduranceRunSeconds = timeToSeconds(enduranceRunTime);

                const results = [
                    {
                        name: '50ç±³è·‘',
                        value: sprint50,
                        unit: 'ç§’',
                        ...getSprint50Score(sprint50, gender)
                    },
                    {
                        name: 'BMIæŒ‡æ•°',
                        value: bmi.toFixed(1),
                        unit: 'kg/mÂ²',
                        ...getBMIScore(bmi, gender)
                    },
                    {
                        name: 'è‚ºæ´»é‡',
                        value: lungCapacity,
                        unit: 'ml',
                        ...getLungCapacityScore(lungCapacity, gender, age)
                    },
                    {
                        name: 'åä½ä½“å‰å±ˆ',
                        value: sitAndReach,
                        unit: 'cm',
                        ...getSitAndReachScore(sitAndReach, gender)
                    },
                    {
                        name: 'è€åŠ›è·‘',
                        value: enduranceRunTime,
                        unit: 'æ—¶é—´',
                        ...getEnduranceRunScore(enduranceRunSeconds, gender)
                    },
                    {
                        name: gender === 'male' ? 'å¼•ä½“å‘ä¸Š' : 'ä»°å§èµ·å',
                        value: strengthTest,
                        unit: 'æ¬¡',
                        ...getStrengthTestScore(strengthTest, gender)
                    },
                    {
                        name: 'ç«‹å®šè·³è¿œ',
                        value: standingJump,
                        unit: 'cm',
                        ...getStandingJumpScore(standingJump, gender)
                    }
                ];

                // åŠ æƒæ€»åˆ†
                const weights = {
                    '50ç±³è·‘': 20,
                    'è€åŠ›è·‘': 20,
                    'BMIæŒ‡æ•°': 15,
                    'è‚ºæ´»é‡': 15,
                    'åä½ä½“å‰å±ˆ': 10,
                    'ç«‹å®šè·³è¿œ': 10
                };
                const totalScore = Math.round(results.reduce((sum, result) => {
                    let w = weights[result.name] ?? 0;
                    if (w === 0 && (result.name.includes('å¼•ä½“å‘ä¸Š') || result.name.includes('ä»°å§èµ·å'))) {
                        w = 10;
                    }
                    result.weight = w;
                    result.weightedScore = +(result.score * w / 100).toFixed(1);
                    return sum + result.score * w / 100;
                }, 0));
                const totalLevel = totalScore >= 90 ? 'excellent' : 
                                 totalScore >= 80 ? 'good' : 
                                 totalScore >= 60 ? 'pass' : 'fail';

                // æ˜¾ç¤ºç»“æœ
                displayResults(results, totalScore, totalLevel);

                // éšè—åŠ è½½çŠ¶æ€
                document.getElementById('loading').classList.remove('show');
                document.getElementById('results').classList.add('show');
            }, 1000);
        }

        function displayResults(results, totalScore, totalLevel) {
            // æ˜¾ç¤ºæ€»åˆ†
            document.getElementById('totalScore').textContent = totalScore;
            document.getElementById('totalLevel').textContent = getLevelText(totalLevel);
            document.getElementById('totalLevel').className = `score-level ${getLevelClass(totalLevel)}`;

            // æ˜¾ç¤ºå•é¡¹æˆç»©
            const scoreGrid = document.getElementById('scoreGrid');
            scoreGrid.innerHTML = '';
            results.forEach(result => {
                const card = document.createElement('div');
                card.className = 'score-card';
                card.innerHTML = `
                    <div class="score-title">${result.name}</div>
                    <div class="score-value">${result.value}</div>
                    <div class="score-level ${getLevelClass(result.level)}">${getLevelText(result.level)}</div>
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">${result.score}åˆ†</div>
                    <div style=\"font-size: 12px; color: #666;\">æƒé‡ ${result.weight || 0}% Â· åŠ æƒ ${result.weightedScore || 0}åˆ†</div>
                `;
                scoreGrid.appendChild(card);
            });

            // ç”Ÿæˆå»ºè®®
            generateSuggestions(results, totalLevel);
        }

        function generateSuggestions(results, totalLevel) {
            const suggestions = [];
            const weakItems = results.filter(result => result.level === 'fail' || result.level === 'pass');
            
            if (weakItems.length === 0) {
                suggestions.push('æ­å–œï¼æ‚¨çš„å„é¡¹ä½“æµ‹æˆç»©éƒ½å¾ˆä¼˜ç§€ï¼Œè¯·ç»§ç»­ä¿æŒè‰¯å¥½çš„è¿åŠ¨ä¹ æƒ¯ã€‚');
            } else {
                suggestions.push('ä»¥ä¸‹æ˜¯é’ˆå¯¹æ‚¨ä½“æµ‹æƒ…å†µçš„æ”¹è¿›å»ºè®®ï¼š');
                
                weakItems.forEach(item => {
                    if (item.name === 'BMIæŒ‡æ•°') {
                        if (item.value < 18.5) {
                            suggestions.push('æ‚¨çš„BMIåä½ï¼Œå»ºè®®å¢åŠ è¥å…»æ‘„å…¥ï¼Œé€‚å½“è¿›è¡ŒåŠ›é‡è®­ç»ƒå¢åŠ è‚Œè‚‰é‡ã€‚');
                        } else {
                            suggestions.push('æ‚¨çš„BMIåé«˜ï¼Œå»ºè®®æ§åˆ¶é¥®é£Ÿï¼Œå¢åŠ æœ‰æ°§è¿åŠ¨ï¼Œæ¯å‘¨è‡³å°‘è¿åŠ¨3-4æ¬¡ã€‚');
                        }
                    } else if (item.name === 'è‚ºæ´»é‡') {
                        suggestions.push('è‚ºæ´»é‡æœ‰å¾…æé«˜ï¼Œå»ºè®®è¿›è¡Œæœ‰æ°§è¿åŠ¨å¦‚æ…¢è·‘ã€æ¸¸æ³³ï¼Œæ¯å¤©æ·±å‘¼å¸ç»ƒä¹ ã€‚');
                    } else if (item.name === 'åä½ä½“å‰å±ˆ') {
                        suggestions.push('æŸ”éŸ§æ€§éœ€è¦æ”¹å–„ï¼Œå»ºè®®æ¯å¤©è¿›è¡Œæ‹‰ä¼¸è¿åŠ¨ï¼Œç‰¹åˆ«æ˜¯è…¿éƒ¨å’Œè…°éƒ¨æ‹‰ä¼¸ã€‚');
                    } else if (item.name === 'è€åŠ›è·‘') {
                        suggestions.push('è€åŠ›è·‘æˆç»©éœ€è¦æå‡ï¼Œå»ºè®®å¾ªåºæ¸è¿›åœ°è¿›è¡Œé•¿è·‘è®­ç»ƒï¼Œæ¯å‘¨å¢åŠ è·‘æ­¥è·ç¦»ã€‚');
                    } else if (item.name.includes('å¼•ä½“å‘ä¸Š') || item.name.includes('ä»°å§èµ·å')) {
                        suggestions.push('åŠ›é‡è®­ç»ƒéœ€è¦åŠ å¼ºï¼Œå»ºè®®è¿›è¡Œé’ˆå¯¹æ€§çš„åŠ›é‡ç»ƒä¹ ï¼Œå¦‚ä¿¯å§æ’‘ã€å¹³æ¿æ”¯æ’‘ç­‰ã€‚');
                    } else if (item.name === 'ç«‹å®šè·³è¿œ') {
                        suggestions.push('çˆ†å‘åŠ›éœ€è¦æå‡ï¼Œå»ºè®®è¿›è¡Œè·³è·ƒè®­ç»ƒï¼Œå¦‚æ·±è¹²è·³ã€å°é˜¶è·³ç­‰ã€‚');
                    }
                });
            }

            // é€šç”¨å»ºè®®
            suggestions.push('å»ºè®®åˆ¶å®šç§‘å­¦çš„è®­ç»ƒè®¡åˆ’ï¼Œæ¯å‘¨è‡³å°‘è¿›è¡Œ3-4æ¬¡ä½“è‚²é”»ç‚¼ï¼Œæ¯æ¬¡30åˆ†é’Ÿä»¥ä¸Šã€‚');
            suggestions.push('è¿åŠ¨å‰è¦åšå¥½çƒ­èº«ï¼Œè¿åŠ¨åè¿›è¡Œé€‚å½“çš„æ‹‰ä¼¸æ”¾æ¾ã€‚');
            suggestions.push('ä¿æŒè‰¯å¥½çš„ä½œæ¯ä¹ æƒ¯ï¼Œä¿è¯å……è¶³çš„ç¡çœ ï¼Œåˆç†é¥®é£Ÿã€‚');

            // æ˜¾ç¤ºå»ºè®®
            const suggestionsList = document.getElementById('suggestionsList');
            suggestionsList.innerHTML = '';
            suggestions.forEach(suggestion => {
                const item = document.createElement('div');
                item.className = 'suggestion-item';
                item.textContent = suggestion;
                suggestionsList.appendChild(item);
            });
        }

        // æ€§åˆ«åˆ‡æ¢æ—¶æ›´æ–°æ ‡ç­¾
        document.querySelectorAll('input[name="gender"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const strengthLabel = document.querySelector('#strengthGroup label');
                const enduranceLabel = document.querySelector('label[for="enduranceRun"]');
                
                if (this.value === 'male') {
                    strengthLabel.textContent = 'å¼•ä½“å‘ä¸Š(ç”·) (æ¬¡) *';
                    enduranceLabel.textContent = '1000ç±³è·‘(ç”·) (åˆ†:ç§’) *';
                } else {
                    strengthLabel.textContent = 'ä»°å§èµ·å(å¥³) (æ¬¡) *';
                    enduranceLabel.textContent = '800ç±³è·‘(å¥³) (åˆ†:ç§’) *';
                }
            });
        });

        // å®æ—¶è¾“å…¥éªŒè¯
        document.querySelectorAll('input[type="number"]').forEach(input => {
            input.addEventListener('input', function() {
                const error = document.getElementById(this.id + '-error');
                if (error) {
                    error.classList.remove('show');
                }
            });
        });

        document.getElementById('enduranceRun').addEventListener('input', function() {
            document.getElementById('enduranceRun-error').classList.remove('show');
        });

        // é¡µé¢åŠ è½½å®Œæˆåæ·»åŠ å®æ—¶éªŒè¯
        document.addEventListener('DOMContentLoaded', function() {
            addRealtimeValidation();

            // æ·»åŠ æ€§åˆ«åˆ‡æ¢æ—¶çš„åŠ¨ç”»æ•ˆæœ
            const genderRadios = document.querySelectorAll('input[name="gender"]');
            genderRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    // æ·»åŠ åˆ‡æ¢åŠ¨ç”»
                    const radioOptions = document.querySelectorAll('.radio-option');
                    radioOptions.forEach(option => {
                        option.style.transform = 'scale(0.95)';
                        setTimeout(() => {
                            option.style.transform = 'scale(1)';
                        }, 150);
                    });
                });
            });
        });

        // æ·»åŠ å®æ—¶éªŒè¯äº‹ä»¶ç›‘å¬å™¨
        function addRealtimeValidation() {
            const fields = ['height', 'weight', 'lungCapacity', 'sitAndReach', 'enduranceRun', 'strengthTest', 'standingJump', 'sprint50'];
            
            fields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    // æ·»åŠ è¾“å…¥äº‹ä»¶ç›‘å¬
                    field.addEventListener('input', function() {
                        validateField(fieldId);
                    });
                    
                    // æ·»åŠ å¤±å»ç„¦ç‚¹äº‹ä»¶ç›‘å¬
                    field.addEventListener('blur', function() {
                        validateField(fieldId);
                    });
                }
            });
        }

        // éªŒè¯å•ä¸ªå­—æ®µ
        function validateField(fieldId) {
            const field = document.getElementById(fieldId);
            const value = field.value.trim();
            
            if (!value) {
                clearFieldValidation(fieldId);
                return;
            }
            
            let isValid = true;
            let errorMessage = '';
            
            switch (fieldId) {
                case 'height':
                    const height = parseFloat(value);
                    if (isNaN(height) || height < 100 || height > 250) {
                        isValid = false;
                        errorMessage = 'èº«é«˜å¿…é¡»åœ¨100-250cmä¹‹é—´';
                    }
                    break;
                    
                case 'weight':
                    const weight = parseFloat(value);
                    if (isNaN(weight) || weight < 30 || weight > 200) {
                        isValid = false;
                        errorMessage = 'ä½“é‡å¿…é¡»åœ¨30-200kgä¹‹é—´';
                    }
                    break;
                    
                case 'lungCapacity':
                    const lungCapacity = parseFloat(value);
                    if (isNaN(lungCapacity) || lungCapacity < 1000 || lungCapacity > 8000) {
                        isValid = false;
                        errorMessage = 'è‚ºæ´»é‡å¿…é¡»åœ¨1000-8000mlä¹‹é—´';
                    }
                    break;
                    
                case 'sitAndReach':
                    const sitAndReach = parseFloat(value);
                    if (isNaN(sitAndReach) || sitAndReach < -30 || sitAndReach > 50) {
                        isValid = false;
                        errorMessage = 'åä½ä½“å‰å±ˆå¿…é¡»åœ¨-30åˆ°50cmä¹‹é—´';
                    }
                    break;
                    
                case 'enduranceRun':
                    if (!isValidTime(value)) {
                        isValid = false;
                        errorMessage = 'æ—¶é—´æ ¼å¼é”™è¯¯ï¼Œè¯·è¾“å…¥å¦‚"4:30"çš„æ ¼å¼';
                    }
                    break;
                    
                case 'strengthTest':
                    const strengthTest = parseInt(value);
                    if (isNaN(strengthTest) || strengthTest < 0 || strengthTest > 100) {
                        isValid = false;
                        errorMessage = 'åŠ›é‡æµ‹è¯•æ¬¡æ•°å¿…é¡»åœ¨0-100ä¹‹é—´';
                    }
                    break;
                    
                case 'standingJump':
                    const standingJump = parseFloat(value);
                    if (isNaN(standingJump) || standingJump < 50 || standingJump > 400) {
                        isValid = false;
                        errorMessage = 'ç«‹å®šè·³è¿œå¿…é¡»åœ¨50-400cmä¹‹é—´';
                    }
                    break;
                case 'sprint50':
                    const sprint50 = parseFloat(value);
                    if (isNaN(sprint50) || sprint50 < 5 || sprint50 > 20) {
                        isValid = false;
                        errorMessage = '50ç±³è·‘å¿…é¡»åœ¨5-20ç§’ä¹‹é—´';
                    }
                    break;
            }
            
            if (isValid) {
                showFieldSuccess(fieldId);
            } else {
                showFieldError(fieldId, errorMessage);
            }
        }

        function showFieldSuccess(fieldId) {
            const field = document.getElementById(fieldId);
            const formGroup = field.closest('.form-group') || field.closest('.input-group');
            
            field.classList.remove('input-error');
            field.classList.add('input-success');
            
            // æ·»åŠ æˆåŠŸå›¾æ ‡
            let icon = formGroup.querySelector('.input-icon');
            if (!icon) {
                icon = document.createElement('div');
                icon.className = 'input-icon';
                formGroup.appendChild(icon);
            }
            icon.className = 'input-icon show success';
            icon.innerHTML = 'âœ“';
            
            // æ·»åŠ æˆåŠŸæ¶ˆæ¯
            let msg = formGroup.querySelector('.validation-message');
            if (!msg) {
                msg = document.createElement('div');
                msg.className = 'validation-message';
                formGroup.appendChild(msg);
            }
            msg.className = 'validation-message success';
            msg.textContent = 'è¾“å…¥æ­£ç¡®';
        }

        function showFieldError(fieldId, errorMessage) {
            const field = document.getElementById(fieldId);
            const formGroup = field.closest('.form-group') || field.closest('.input-group');
            
            field.classList.remove('input-success');
            field.classList.add('input-error');
            
            // æ·»åŠ é”™è¯¯å›¾æ ‡
            let icon = formGroup.querySelector('.input-icon');
            if (!icon) {
                icon = document.createElement('div');
                icon.className = 'input-icon';
                formGroup.appendChild(icon);
            }
            icon.className = 'input-icon show error';
            icon.innerHTML = 'âœ—';
            
            // æ·»åŠ é”™è¯¯æ¶ˆæ¯
            let msg = formGroup.querySelector('.validation-message');
            if (!msg) {
                msg = document.createElement('div');
                msg.className = 'validation-message';
                formGroup.appendChild(msg);
            }
            msg.className = 'validation-message error';
            msg.textContent = errorMessage;
        }

        // è®­ç»ƒè®¡åˆ’ç›¸å…³å‡½æ•°
        function showTrainingPlanSection() {
            const results = document.getElementById('results');
            const trainingSection = document.getElementById('trainingPlanSection');
            
            // æ˜¾ç¤ºè®­ç»ƒè®¡åˆ’éƒ¨åˆ†
            trainingSection.style.display = 'block';
            trainingSection.scrollIntoView({ behavior: 'smooth' });
            
            // è‡ªåŠ¨å¡«å……å»ºè®®çš„ç›®æ ‡å€¼
            autoFillTargetValues();
        }

        function autoFillTargetValues() {
            // è·å–å½“å‰æˆç»©
            const currentScores = JSON.parse(localStorage.getItem('currentScores') || '{}');
            const currentTotal = parseInt(document.getElementById('totalScore').textContent);
            
            // å»ºè®®ç›®æ ‡æˆç»©æ¯”å½“å‰æˆç»©é«˜5-15åˆ†
            const suggestedTarget = Math.min(100, currentTotal + Math.floor(Math.random() * 11) + 5);
            document.getElementById('targetScore').value = suggestedTarget;
            
            // å»ºè®®è®­ç»ƒæ—¶é—´ï¼ˆæ ¹æ®å·®è·è°ƒæ•´ï¼‰
            const scoreGap = suggestedTarget - currentTotal;
            const suggestedDays = Math.max(14, Math.min(90, scoreGap * 3));
            document.getElementById('examDays').value = suggestedDays;
            
            // ä¸ºå„ä¸ªé¡¹ç›®è®¾ç½®åˆç†çš„ç›®æ ‡å€¼
            if (currentScores.lungCapacity) {
                const current = currentScores.lungCapacity.value;
                const target = Math.min(8000, Math.floor(current * 1.1));
                document.getElementById('targetLungCapacity').value = target;
            }
            
            if (currentScores.sitAndReach) {
                const current = currentScores.sitAndReach.value;
                const target = Math.min(50, current + 3);
                document.getElementById('targetSitAndReach').value = target;
            }
            
            if (currentScores.enduranceRun) {
                const currentSeconds = currentScores.enduranceRun.value;
                const targetSeconds = Math.max(180, currentSeconds - 15); // å‡å°‘15ç§’
                const minutes = Math.floor(targetSeconds / 60);
                const seconds = targetSeconds % 60;
                document.getElementById('targetEnduranceRun').value = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
            
            if (currentScores.strengthTest) {
                const current = currentScores.strengthTest.value;
                const target = Math.min(100, Math.floor(current * 1.2));
                document.getElementById('targetStrengthTest').value = target;
            }
            
            if (currentScores.standingJump) {
                const current = currentScores.standingJump.value;
                const target = Math.min(400, Math.floor(current * 1.05));
                document.getElementById('targetStandingJump').value = target;
            }
        }

        function generateTrainingPlan() {
            // éªŒè¯è¾“å…¥
            const targetScore = document.getElementById('targetScore').value;
            const examDays = document.getElementById('examDays').value;
            
            if (!targetScore || !examDays) {
                alert('è¯·å¡«å†™ç›®æ ‡æˆç»©å’Œè€ƒè¯•æ—¶é—´ï¼');
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
            document.getElementById('trainingLoading').style.display = 'block';
            
            // æ¨¡æ‹Ÿç”Ÿæˆè¿‡ç¨‹
            setTimeout(() => {
                try {
                    const plan = createTrainingPlan();
                    displayTrainingPlan(plan);
                } catch (e) {
                    console.error(e);
                    alert('ç”Ÿæˆè®­ç»ƒè®¡åˆ’æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¾“å…¥åé‡è¯•ã€‚');
                } finally {
                    document.getElementById('trainingLoading').style.display = 'none';
                }
            }, 600);
        }

        function createTrainingPlan() {
            const currentScores = JSON.parse(localStorage.getItem('currentScores') || '{}');
            const targetScore = parseInt(document.getElementById('targetScore').value);
            const examDays = parseInt(document.getElementById('examDays').value);
            
            // è·å–ç›®æ ‡å€¼
            const targets = {
                lungCapacity: parseInt(document.getElementById('targetLungCapacity').value) || 0,
                sitAndReach: parseFloat(document.getElementById('targetSitAndReach').value) || 0,
                enduranceRun: timeToSeconds(document.getElementById('targetEnduranceRun').value) || 0,
                strengthTest: parseInt(document.getElementById('targetStrengthTest').value) || 0,
                standingJump: parseInt(document.getElementById('targetStandingJump').value) || 0
            };
            
            // åˆ†æå·®è·
            const gaps = analyzeGaps(currentScores, targets);
            
            // ç”Ÿæˆè®­ç»ƒè®¡åˆ’
            const plan = {
                summary: {
                    totalDays: examDays,
                    targetScore: targetScore,
                    currentScore: parseInt(document.getElementById('totalScore').textContent),
                    phases: calculateTrainingPhases(examDays)
                },
                phases: [],
                dailyPlan: []
            };
            
            // åˆ›å»ºé˜¶æ®µæ€§è®­ç»ƒè®¡åˆ’ï¼ˆæŒ‰30%/30%/25%/15%åˆ†é…å¤©æ•°ï¼‰
            const phases = ['åŸºç¡€æœŸ', 'æå‡æœŸ', 'å¼ºåŒ–æœŸ', 'å†²åˆºæœŸ'];
            const phaseDayMap = plan.summary.phases; // { base, improvement, intensive, sprint }
            const daysByPhaseIndex = [phaseDayMap.base, phaseDayMap.improvement, phaseDayMap.intensive, phaseDayMap.sprint];

            for (let i = 0; i < 4; i++) {
                const phase = {
                    name: phases[i],
                    days: daysByPhaseIndex[i],
                    focus: getPhaseFocus(i, gaps),
                    training: generatePhaseTraining(i, gaps, targets)
                };
                plan.phases.push(phase);
            }
            
            // ç”Ÿæˆæ¯æ—¥è¯¦ç»†è®¡åˆ’
            plan.dailyPlan = generateDailyPlan(plan.phases, examDays);
            
            return plan;
        }

        function analyzeGaps(current, targets) {
            const gaps = {};
            const gender = document.querySelector('input[name="gender"]:checked').value;
            
            Object.keys(targets).forEach(key => {
                if (current[key] && targets[key]) {
                    let gap = 0;
                    let priority = 'medium';
                    
                    switch (key) {
                        case 'lungCapacity':
                            gap = targets[key] - current[key].value;
                            priority = gap > 500 ? 'high' : gap > 200 ? 'medium' : 'low';
                            break;
                        case 'sitAndReach':
                            gap = targets[key] - current[key].value;
                            priority = gap > 5 ? 'high' : gap > 2 ? 'medium' : 'low';
                            break;
                        case 'enduranceRun':
                            gap = current[key].value - targets[key]; // æ—¶é—´è¶ŠçŸ­è¶Šå¥½
                            priority = gap > 30 ? 'high' : gap > 15 ? 'medium' : 'low';
                            break;
                        case 'strengthTest':
                            gap = targets[key] - current[key].value;
                            priority = gap > 10 ? 'high' : gap > 5 ? 'medium' : 'low';
                            break;
                        case 'standingJump':
                            gap = targets[key] - current[key].value;
                            priority = gap > 20 ? 'high' : gap > 10 ? 'medium' : 'low';
                            break;
                    }
                    
                    gaps[key] = {
                        current: current[key].value,
                        target: targets[key],
                        gap: gap,
                        priority: priority
                    };
                }
            });
            
            return gaps;
        }

        function getPhaseFocus(phaseIndex, gaps) {
            const highPriorityItems = Object.keys(gaps).filter(key => gaps[key].priority === 'high');
            const mediumPriorityItems = Object.keys(gaps).filter(key => gaps[key].priority === 'medium');
            
            switch (phaseIndex) {
                case 0: return 'åŸºç¡€ä½“èƒ½å»ºè®¾ï¼ŒæŠ€æœ¯åŠ¨ä½œè§„èŒƒ';
                case 1: return highPriorityItems.length > 0 ? `é‡ç‚¹çªç ´: ${highPriorityItems.join('ã€')}` : 'ç»¼åˆèƒ½åŠ›æå‡';
                case 2: return 'ä¸“é¡¹å¼ºåŒ–ï¼Œå¼±ç‚¹é’ˆå¯¹æ€§è®­ç»ƒ';
                case 3: return 'çŠ¶æ€è°ƒæ•´ï¼Œæ¨¡æ‹Ÿæµ‹è¯•';
                default: return 'ç»¼åˆè®­ç»ƒ';
            }
        }

        function generatePhaseTraining(phaseIndex, gaps, targets) {
            const training = [];
            const gender = document.querySelector('input[name="gender"]:checked').value;

            // åŸºç¡€è®­ç»ƒé¡¹ç›®ï¼ˆæ¯å¤©å›ºå®šï¼‰
            const baseTraining = [
                { item: 'çƒ­èº«ï¼šæ…¢è·‘+åŠ¨æ€æ‹‰ä¼¸', duration: '10åˆ†é’Ÿ', intensity: 'è½»æ¾', detail: 'å…³èŠ‚æ´»åŠ¨+åŠ¨æ€æ‹‰ä¼¸', type: 'warmup' },
                { item: 'æ•´ç†æ”¾æ¾ï¼šé™æ€æ‹‰ä¼¸', duration: '10-15åˆ†é’Ÿ', intensity: 'è½»æ¾', detail: 'ä¸‹è‚¢ã€é«‹å±ˆè‚Œã€èƒŒéƒ¨', type: 'cooldown' }
            ];

            // æ‰€æœ‰ä½“æµ‹é¡¹ç›®ï¼Œä¿è¯è¦†ç›–
            const allItems = ['sprint50', 'enduranceRun', 'lungCapacity', 'sitAndReach', 'standingJump', 'strengthTest'];

            // æ ¹æ®é˜¶æ®µå’Œå·®è·ç”Ÿæˆä¸“é¡¹è®­ç»ƒï¼Œè‹¥æ— å·®è·ä¹Ÿå®‰æ’åŸºç¡€è®­ç»ƒï¼Œä¿è¯è¦†ç›–
            allItems.forEach(key => {
                const gap = gaps[key] || { priority: 'medium' };
                // é«˜ä¼˜å…ˆçº§é¡¹ç›®åœ¨æ‰€æœ‰é˜¶æ®µéƒ½å®‰æ’ï¼›ä¸­ä¼˜å…ˆçº§ä»æå‡æœŸå¼€å§‹åŠ å¼ºï¼›ä½ä¼˜å…ˆçº§åœ¨åŸºç¡€æœŸå®‰æ’åŸºç¡€ç»ƒä¹ 
                const shouldInclude = gap.priority === 'high' || (phaseIndex >= 1 && gap.priority === 'medium') || phaseIndex === 0;
                if (shouldInclude) {
                    training.push(...getSpecificTraining(key, gap, phaseIndex, gender));
                }
            });

            return [...baseTraining, ...training];
        }

        function getSpecificTraining(item, gap, phaseIndex, gender) {
            const trainings = [];
            const intensity = getTrainingIntensity(phaseIndex);

            // é˜¶æ®µå¼ºåº¦ç³»æ•°ï¼šåŸºç¡€æœŸ(0)â†’æå‡æœŸ(1)â†’å¼ºåŒ–æœŸ(2)â†’å†²åˆºæœŸ(3)
            const phaseFactor = [0.9, 1.0, 1.1, 0.95][phaseIndex];
            const restSec = (base) => `${Math.round(base * phaseFactor)}ç§’`;

            switch (item) {
                case 'sprint50':
                    trainings.push(
                        { item: 'èµ·è·‘ç»ƒä¹ ï¼ˆè¹²è¸å¼ï¼‰', duration: '8Ã—20ç±³', intensity: intensity, detail: `ä¸“æ³¨ååº”ä¸ç¬¬ä¸€æ­¥çˆ†å‘ï¼Œç»„é—´ä¼‘æ¯${restSec(60)}`, type: 'sprint' },
                        { item: 'åŠ é€Ÿè·‘', duration: '6Ã—30ç±³', intensity: intensity, detail: `é€æ­¥æé€Ÿè‡³90%ï¼Œç»„é—´ä¼‘æ¯${restSec(75)}`, type: 'sprint' },
                        { item: 'å…¨åŠ›å†²åˆº', duration: '4Ã—50ç±³', intensity: phaseIndex === 3 ? 'è€ƒè¯•é…é€Ÿ' : 'é«˜å¼ºåº¦', detail: `95-100%å¼ºåº¦ï¼Œç»„é—´ä¼‘æ¯${restSec(90)}`, type: 'sprint' }
                    );
                    break;
                case 'enduranceRun':
                    trainings.push(
                        { item: 'æœ‰æ°§åŸºç¡€è·‘', duration: gender === 'male' ? '1Ã—3000ç±³æˆ–20-30åˆ†é’Ÿ' : '1Ã—2500ç±³æˆ–18-28åˆ†é’Ÿ', intensity: 'ä¸­ç­‰', detail: 'å¿ƒç‡ä¿æŒåœ¨æœ€å¤§å¿ƒç‡çš„60-70%', type: 'endurance' },
                        { item: 'é—´æ­‡è·‘', duration: gender === 'male' ? '6Ã—400ç±³' : '6Ã—300ç±³', intensity: phaseIndex === 3 ? 'è€ƒè¯•é…é€Ÿ' : 'é«˜å¼ºåº¦', detail: `é…é€Ÿæ¥è¿‘è€ƒè¯•é…é€Ÿï¼Œç»„é—´æ…¢èµ°${restSec(90)}`, type: 'endurance' },
                        { item: 'èŠ‚å¥è·‘', duration: gender === 'male' ? '2Ã—1200ç±³' : '2Ã—800ç±³', intensity: 'ä¸­é«˜', detail: `ç•¥å¿«äºè€ƒè¯•é…é€Ÿï¼Œç»„é—´ä¼‘æ¯${restSec(180)}`, type: 'endurance' }
                    );
                    break;
                case 'lungCapacity':
                    trainings.push(
                        { item: 'æ·±å‘¼å¸è®­ç»ƒ', duration: '3ç»„Ã—10æ¬¡', intensity: 'ä¸­ç­‰', detail: 'è…¹å¼å‘¼å¸ï¼Œå¸æ°”4ç§’ã€å±æ¯2ç§’ã€å‘¼æ°”6ç§’', type: 'respiratory' },
                        { item: 'å¹æ°”è®­ç»ƒï¼ˆæ°”çƒ/å¹ç®¡ï¼‰', duration: '4ç»„Ã—30ç§’', intensity: 'ä¸­ç­‰', detail: 'ç¨³å®šä¸”æŒç»­çš„å‘¼æ°”ï¼Œç»„é—´ä¼‘æ¯30ç§’', type: 'respiratory' },
                        { item: 'æœ‰æ°§æ´»åŠ¨ï¼ˆæ…¢è·‘/éª‘è¡Œï¼‰', duration: '20-30åˆ†é’Ÿ', intensity: intensity, detail: 'å‡åŒ€å‘¼å¸ï¼Œä¿æŒäº¤æµå¼ºåº¦', type: 'respiratory' }
                    );
                    break;
                case 'sitAndReach':
                    trainings.push(
                        { item: 'åŠ¨æ€æ‹‰ä¼¸', duration: '3ç»„Ã—12æ¬¡', intensity: 'è½»æ¾', detail: 'è…¿éƒ¨æ‘†åŠ¨ã€é«‹å±ˆè‚Œæ¿€æ´»', type: 'flexibility' },
                        { item: 'åä½ä½“å‰å±ˆä¸“é¡¹', duration: '4ç»„Ã—30ç§’', intensity: 'ä¸­ç­‰', detail: 'é€æ­¥åŠ æ·±å¹…åº¦ï¼Œæ¯ç»„é—´ä¼‘æ¯20ç§’', type: 'flexibility' },
                        { item: 'é™æ€æ‹‰ä¼¸ï¼ˆè…˜ç»³è‚Œ/å°è…¿ï¼‰', duration: '3ç»„Ã—30ç§’', intensity: 'è½»æ¾', detail: 'æ¯æ¬¡ä¿æŒç¨³å®šå‘¼å¸', type: 'flexibility' }
                    );
                    break;
                case 'standingJump':
                    trainings.push(
                        { item: 'ä¸‹è‚¢åŠ›é‡ï¼šæ·±è¹²', duration: '4ç»„Ã—10æ¬¡', intensity: 'ä¸­é«˜', detail: `ä½“é‡æˆ–è½»è´Ÿé‡ï¼Œç»„é—´ä¼‘æ¯${restSec(60)}`, type: 'jump' },
                        { item: 'çˆ†å‘åŠ›ï¼šè·³ç®±', duration: '4ç»„Ã—8æ¬¡', intensity: 'é«˜å¼ºåº¦', detail: `é«˜ç®±è·³ï¼Œå¼ºè°ƒå¿«é€Ÿç¦»åœ°ï¼Œç»„é—´ä¼‘æ¯${restSec(75)}`, type: 'jump' },
                        { item: 'æŠ€æœ¯ç»ƒä¹ ï¼šç«‹å®šè·³è¿œ', duration: '6ç»„Ã—3æ¬¡', intensity: intensity, detail: `åŠ©åŠ›æ‘†è‡‚+åè°ƒè½åœ°ï¼Œç»„é—´ä¼‘æ¯${restSec(60)}`, type: 'jump' }
                    );
                    break;
                case 'strengthTest':
                    if (gender === 'male') {
                        trainings.push(
                            { item: 'å¼•ä½“å‘ä¸Šåˆ†ç»„', duration: '5ç»„Ã—å°½åŠ›', intensity: 'é«˜å¼ºåº¦', detail: `æ¯ç»„åšåˆ°åŠ›ç«­ï¼Œç»„é—´ä¼‘æ¯${restSec(90)}`, type: 'strength' },
                            { item: 'è¾…åŠ©ï¼šå¼¹åŠ›å¸¦å¼•ä½“', duration: '3ç»„Ã—8-12æ¬¡', intensity: 'ä¸­é«˜', detail: 'æ§åˆ¶èŠ‚å¥ï¼Œä¸Šä¸‹2-3ç§’', type: 'strength' },
                            { item: 'æ ¸å¿ƒï¼šæ‚¬å‚ä¸¾è…¿', duration: '4ç»„Ã—10æ¬¡', intensity: 'ä¸­ç­‰', detail: 'ç¨³å®šæ ¸å¿ƒï¼Œé¿å…æ‘†åŠ¨', type: 'strength' }
                        );
                    } else {
                        trainings.push(
                            { item: 'ä»°å§èµ·ååˆ†ç»„', duration: '5ç»„Ã—20-30æ¬¡', intensity: 'ä¸­é«˜', detail: `å‡åŒ€å‘¼å¸ï¼Œç»„é—´ä¼‘æ¯${restSec(60)}`, type: 'strength' },
                            { item: 'æ ¸å¿ƒç¨³å®šï¼šå¹³æ¿æ”¯æ’‘', duration: '4ç»„Ã—40-60ç§’', intensity: 'ä¸­ç­‰', detail: 'ä¿æŒèº¯å¹²ç¨³å®š', type: 'strength' },
                            { item: 'ä¸Šè‚¢åŠ›é‡ï¼šä¿¯å§æ’‘', duration: '4ç»„Ã—12-15æ¬¡', intensity: 'ä¸­é«˜', detail: 'æ§åˆ¶èŠ‚å¥ï¼Œä¸Šä¸‹2-3ç§’', type: 'strength' }
                        );
                    }
                    break;
            }

            return trainings;
        }

        function getTrainingIntensity(phaseIndex) {
            switch (phaseIndex) {
                case 0: return 'ä½å¼ºåº¦'; // åŸºç¡€æœŸï¼šä½å¼ºåº¦ï¼Œé‡ç‚¹æŒæ¡æŠ€æœ¯åŠ¨ä½œ
                case 1: return 'ä¸­ç­‰';   // æå‡æœŸï¼šä¸­ç­‰å¼ºåº¦ï¼Œå¢åŠ è®­ç»ƒé‡
                case 2: return 'é«˜å¼ºåº¦'; // å¼ºåŒ–æœŸï¼šé«˜å¼ºåº¦ï¼Œæ¥è¿‘è€ƒè¯•æ ‡å‡†
                case 3: return 'è€ƒè¯•é…é€Ÿ'; // å†²åˆºæœŸï¼šæ¨¡æ‹Ÿè€ƒè¯•/è€ƒè¯•é…é€Ÿ
                default: return 'ä¸­ç­‰';
            }
        }

        function generateDailyPlan(phases, totalDays) {
            const dailyPlan = [];
            let currentDay = 1;
            const gender = document.querySelector('input[name="gender"]:checked')?.value || 'male';
            
            phases.forEach((phase, phaseIndex) => {
                for (let day = 1; day <= phase.days; day++) {
                    const plan = {
                        day: currentDay,
                        phase: phase.name,
                        date: new Date(Date.now() + (currentDay - 1) * 24 * 60 * 60 * 1000).toLocaleDateString(),
                        training: [],
                        rest: false
                    };

                    // æ¯7å¤©å®‰æ’1å¤©ä¼‘æ¯
                    if (currentDay % 7 === 0) {
                        plan.rest = true;
                        plan.training = [
                            { item: 'è½»æ¾æ•£æ­¥', duration: '30åˆ†é’Ÿ', intensity: 'è½»æ¾', detail: 'å…¨èº«æ”¾æ¾' },
                            { item: 'æ‹‰ä¼¸æ”¾æ¾', duration: '20åˆ†é’Ÿ', intensity: 'è½»æ¾', detail: 'ä¸‹è‚¢+èƒŒéƒ¨' }
                        ];
                    } else {
                        // å†²åˆºæœŸæ¯3-4å¤©åŠ å…¥ä¸€æ¬¡æ¨¡æ‹Ÿä½“æµ‹ï¼ˆå«50ç±³å†²åˆºã€è€åŠ›è·‘é…é€Ÿæµ‹è¯•ã€ç«‹å®šè·³è¿œå•æ¬¡æœ€å¤§ã€åŠ›é‡é¡¹ç›®è®¡æ¬¡ï¼‰
                        const isSprintPhase = phase.name === 'å†²åˆºæœŸ';
                        const isMockTestDay = isSprintPhase && ((day % 3 === 0) || (day % 4 === 0));

                        if (isMockTestDay) {
                            plan.training = [
                                { item: 'æ¨¡æ‹Ÿä½“æµ‹ï¼š50ç±³å†²åˆº', duration: '2Ã—50ç±³', intensity: 'é«˜å¼ºåº¦', detail: 'è®¡æ—¶ï¼Œè®°å½•æœ€ä½³' },
                                { item: 'æ¨¡æ‹Ÿä½“æµ‹ï¼šè€åŠ›è·‘é…é€Ÿ', duration: gender === 'male' ? '1Ã—1000ç±³' : '1Ã—800ç±³', intensity: 'ä¸­é«˜', detail: 'æ¥è¿‘è€ƒè¯•é…é€Ÿ' },
                                { item: 'æ¨¡æ‹Ÿä½“æµ‹ï¼šç«‹å®šè·³è¿œ', duration: '3æ¬¡', intensity: 'ä¸­é«˜', detail: 'è®°å½•æœ€è¿œ' },
                                { item: gender === 'male' ? 'æ¨¡æ‹Ÿä½“æµ‹ï¼šå¼•ä½“å‘ä¸Š' : 'æ¨¡æ‹Ÿä½“æµ‹ï¼šä»°å§èµ·å', duration: gender === 'male' ? 'å°½åŠ›1ç»„' : '1åˆ†é’Ÿè®¡æ¬¡', intensity: 'é«˜å¼ºåº¦', detail: 'è®°å½•æˆç»©' }
                            ];
                        } else {
                            // æ ¹æ®é˜¶æ®µé‡ç‚¹å®‰æ’è®­ç»ƒ
                            plan.training = generateDayTraining(phase, day, phaseIndex);
                        }
                    }

                    dailyPlan.push(plan);
                    currentDay++;
                }
            });
            
            return dailyPlan;
        }

        function generateDayTraining(phase, day, phaseIndex) {
            const training = [];

            // çƒ­èº«
            training.push(
                { item: 'çƒ­èº«ï¼šæ…¢è·‘+å…³èŠ‚æ´»åŠ¨', duration: '10åˆ†é’Ÿ', intensity: 'è½»æ¾', detail: 'è¸ã€è†ã€é«‹ã€è‚©', type: 'warmup' },
                { item: 'åŠ¨æ€æ‹‰ä¼¸', duration: '10åˆ†é’Ÿ', intensity: 'è½»æ¾', detail: 'æ‘†è…¿ã€å¼“æ­¥æ‰­è½¬', type: 'warmup' }
            );

            // æ ¹æ®é˜¶æ®µæ·»åŠ ä¸»è¦è®­ç»ƒå†…å®¹
            const mainTraining = phase.training.filter(item => 
                (item.type ? (item.type !== 'warmup' && item.type !== 'cooldown') : (!item.item.includes('çƒ­èº«') && !item.item.includes('æ‹‰ä¼¸')))
            );

            // æŒ‰ç±»å‹åˆ†ç»„ï¼Œç¡®ä¿æ¯å¤©è¦†ç›–ä¸åŒé¡¹ç›®
            const typeOrder = ['sprint', 'endurance', 'jump', 'strength', 'flexibility', 'respiratory'];
            const rotatedOrder = [...typeOrder.slice(((day - 1) % typeOrder.length)), ...typeOrder.slice(0, ((day - 1) % typeOrder.length))];

            const byType = new Map();
            mainTraining.forEach(t => {
                const typeKey = t.type || 'other';
                if (!byType.has(typeKey)) byType.set(typeKey, []);
                byType.get(typeKey).push(t);
            });

            const selected = [];
            for (const type of rotatedOrder) {
                if (selected.length >= 3) break;
                const list = byType.get(type);
                if (list && list.length > 0) {
                    selected.push(list[0]);
                    list.shift();
                }
            }

            // è‹¥ä¸è¶³3é¡¹ï¼Œè¡¥å……å…¶å®ƒç±»å‹ï¼ˆé¿å…é‡å¤ç±»å‹ï¼‰
            if (selected.length < 3) {
                const remaining = [].concat(...Array.from(byType.values()));
                for (const t of remaining) {
                    if (selected.length >= 3) break;
                    if (!selected.some(s => (s.type || 'other') === (t.type || 'other'))) {
                        selected.push(t);
                    }
                }
            }

            training.push(...selected);

            // æ•´ç†æ”¾æ¾
            training.push(
                { item: 'é™æ€æ‹‰ä¼¸', duration: '10-15åˆ†é’Ÿ', intensity: 'è½»æ¾', detail: 'è…˜ç»³è‚Œ/å°è…¿/é«‹å±ˆè‚Œ', type: 'cooldown' }
            );

            return training.map(t => ({ ...t }));
        }

        function calculateTrainingPhases(totalDays) {
            return {
                base: Math.floor(totalDays * 0.3),      // åŸºç¡€æœŸ 30%
                improvement: Math.floor(totalDays * 0.3), // æå‡æœŸ 30%
                intensive: Math.floor(totalDays * 0.25),  // å¼ºåŒ–æœŸ 25%
                sprint: totalDays - Math.floor(totalDays * 0.85) // å†²åˆºæœŸ 15%
            };
        }

        function displayTrainingPlan(plan) {
            const trainingResults = document.getElementById('trainingResults');
            const summary = document.getElementById('trainingPlanSummary');
            const details = document.getElementById('trainingPlanDetails');
            
            // æ˜¾ç¤ºè®­ç»ƒè®¡åˆ’ç»“æœ
            trainingResults.style.display = 'block';
            
            // æ˜¾ç¤ºæ€»ç»“ä¿¡æ¯
            summary.innerHTML = `
                <div style="font-size: 1.2em; margin-bottom: 15px;">
                    ğŸ“ˆ å½“å‰æˆç»©: <strong>${plan.summary.currentScore}åˆ†</strong> â†’ ç›®æ ‡æˆç»©: <strong>${plan.summary.targetScore}åˆ†</strong>
                </div>
                <div style="font-size: 1.1em; margin-bottom: 15px;">
                    â±ï¸ è®­ç»ƒå‘¨æœŸ: <strong>${plan.summary.totalDays}å¤©</strong>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-top: 20px;">
                    <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 0.9em;">åŸºç¡€æœŸ</div>
                        <div style="font-size: 1.2em; font-weight: bold;">${plan.summary.phases.base}å¤©</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 0.9em;">æå‡æœŸ</div>
                        <div style="font-size: 1.2em; font-weight: bold;">${plan.summary.phases.improvement}å¤©</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 0.9em;">å¼ºåŒ–æœŸ</div>
                        <div style="font-size: 1.2em; font-weight: bold;">${plan.summary.phases.intensive}å¤©</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 0.9em;">å†²åˆºæœŸ</div>
                        <div style="font-size: 1.2em; font-weight: bold;">${plan.summary.phases.sprint}å¤©</div>
                    </div>
                </div>
            `;
            
            // æ˜¾ç¤ºè¯¦ç»†è®­ç»ƒè®¡åˆ’
            details.innerHTML = '';
            
            // æ˜¾ç¤ºé˜¶æ®µæ€»ç»“
            plan.phases.forEach(phase => {
                const phaseDiv = document.createElement('div');
                phaseDiv.className = 'suggestions';
                phaseDiv.style.marginBottom = '20px';
                phaseDiv.innerHTML = `
                    <h4 style="color: #2d3748; margin-bottom: 15px; font-size: 1.2em;">
                        ğŸ“Š ${phase.name} (${phase.days}å¤©)
                    </h4>
                    <p style="margin-bottom: 15px; color: #4a5568;">
                        <strong>è®­ç»ƒé‡ç‚¹:</strong> ${phase.focus}
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                        ${phase.training.map(item => `
                            <div style="background: #f7fafc; padding: 12px; border-radius: 8px; border-left: 4px solid #4facfe;">
                                <div style="font-weight: 600; color: #2d3748;">${item.item}</div>
                                <div style="font-size: 0.9em; color: #718096;">${item.duration} | ${item.intensity}</div>
                                ${item.detail ? `<div style="font-size: 0.85em; color: #A0AEC0; margin-top: 4px;">${item.detail}</div>` : ''}
                            </div>
                        `).join('')}
                    </div>
                `;
                details.appendChild(phaseDiv);
            });
            
            // æ˜¾ç¤ºæ¯æ—¥è¯¦ç»†è®¡åˆ’ï¼ˆå‰7å¤©å’Œå7å¤©ï¼‰
            const dailyPlanDiv = document.createElement('div');
            dailyPlanDiv.className = 'suggestions';
            dailyPlanDiv.innerHTML = `
                <h4 style="color: #2d3748; margin-bottom: 15px; font-size: 1.2em;">
                    ğŸ“… è¯¦ç»†è®­ç»ƒå®‰æ’
                </h4>
                <div style="max-height: 400px; overflow-y: auto;">
                    ${plan.dailyPlan.slice(0, 14).map(day => `
                        <div style="background: ${day.rest ? '#f0fff4' : '#f7fafc'}; padding: 15px; margin-bottom: 10px; border-radius: 10px; border-left: 4px solid ${day.rest ? '#48bb78' : '#4facfe'};">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div style="font-weight: 600; color: #2d3748;">
                                    ç¬¬${day.day}å¤© - ${day.phase}
                                </div>
                                <div style="font-size: 0.9em; color: #718096;">${day.date}</div>
                                ${day.rest ? '<span style="background: #48bb78; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8em;">ä¼‘æ¯æ—¥</span>' : ''}
                            </div>
                            <div style="display: grid; gap: 8px;">
                                ${day.training.map(item => `
                                    <div style="display: grid; grid-template-columns: 1.2fr 0.8fr 1fr; gap: 8px; align-items: center; padding: 8px; background: white; border-radius: 6px;">
                                        <span style="color: #2d3748;">${item.item}</span>
                                        <span style="font-size: 0.9em; color: #718096;">${item.duration} | ${item.intensity}</span>
                                        ${item.detail ? `<span style="font-size: 0.85em; color: #A0AEC0;">${item.detail}</span>` : '<span></span>'}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
                ${plan.dailyPlan.length > 14 ? `
                    <div style="text-align: center; margin-top: 15px;">
                        <button onclick="showFullPlan()" class="btn" style="padding: 10px 20px; font-size: 14px;">
                            æŸ¥çœ‹å®Œæ•´${plan.dailyPlan.length}å¤©è®¡åˆ’
                        </button>
                    </div>
                ` : ''}
            `;
            details.appendChild(dailyPlanDiv);
            
            // ä¿å­˜è®­ç»ƒè®¡åˆ’åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('trainingPlan', JSON.stringify(plan));
            
            // ä¿å­˜åˆ°å†å²è®°å½•
            saveTrainingPlanHistory(plan);
            
            // æ»šåŠ¨åˆ°è®­ç»ƒè®¡åˆ’ç»“æœ
            trainingResults.scrollIntoView({ behavior: 'smooth' });
        }

        function showFullPlan() {
            const plan = JSON.parse(localStorage.getItem('trainingPlan'));
            const details = document.getElementById('trainingPlanDetails');
            
            // æ›¿æ¢ä¸ºå®Œæ•´è®¡åˆ’
            const fullPlanDiv = document.createElement('div');
            fullPlanDiv.className = 'suggestions';
            fullPlanDiv.innerHTML = `
                <h4 style="color: #2d3748; margin-bottom: 15px; font-size: 1.2em;">
                    ğŸ“… å®Œæ•´è®­ç»ƒå®‰æ’ (${plan.dailyPlan.length}å¤©)
                </h4>
                <div style="max-height: 600px; overflow-y: auto;">
                    ${plan.dailyPlan.map(day => `
                        <div style="background: ${day.rest ? '#f0fff4' : '#f7fafc'}; padding: 15px; margin-bottom: 8px; border-radius: 10px; border-left: 4px solid ${day.rest ? '#48bb78' : '#4facfe'};">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div style="font-weight: 600; color: #2d3748;">
                                    ç¬¬${day.day}å¤© - ${day.phase}
                                </div>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div style="font-size: 0.9em; color: #718096;">${day.date}</div>
                                    ${day.rest ? '<span style="background: #48bb78; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8em;">ä¼‘æ¯æ—¥</span>' : ''}
                                </div>
                            </div>
                            <div style="display: grid; gap: 6px;">
                                ${day.training.map(item => `
                                    <div style="display: grid; grid-template-columns: 1.2fr 0.8fr 1fr; gap: 8px; align-items: center; padding: 6px 8px; background: white; border-radius: 5px; font-size: 0.95em;">
                                        <span style="color: #2d3748;">${item.item}</span>
                                        <span style="color: #718096;">${item.duration} | ${item.intensity}</span>
                                        ${item.detail ? `<span style="font-size: 0.85em; color: #A0AEC0;">${item.detail}</span>` : '<span></span>'}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            // æ›¿æ¢ç°æœ‰çš„æ¯æ—¥è®¡åˆ’éƒ¨åˆ†
            const existingDailyPlan = details.querySelector('.suggestions:last-child');
            if (existingDailyPlan) {
                details.replaceChild(fullPlanDiv, existingDailyPlan);
            }
        }

        function exportTrainingPlan() {
            const plan = JSON.parse(localStorage.getItem('trainingPlan'));
            if (!plan) {
                alert('æ²¡æœ‰å¯å¯¼å‡ºçš„è®­ç»ƒè®¡åˆ’ï¼');
                return;
            }
            
            // åˆ›å»ºå¯¼å‡ºå†…å®¹
            let exportContent = `ä¸ªæ€§åŒ–ä½“æµ‹è®­ç»ƒè®¡åˆ’\n`;
            exportContent += `==================\n\n`;
            exportContent += `ğŸ“ˆ æˆç»©ç›®æ ‡: ${plan.summary.currentScore}åˆ† â†’ ${plan.summary.targetScore}åˆ†\n`;
            exportContent += `â±ï¸ è®­ç»ƒå‘¨æœŸ: ${plan.summary.totalDays}å¤©\n`;
            exportContent += `ğŸ“Š è®­ç»ƒé˜¶æ®µ: åŸºç¡€æœŸ${plan.summary.phases.base}å¤© â†’ æå‡æœŸ${plan.summary.phases.improvement}å¤© â†’ å¼ºåŒ–æœŸ${plan.summary.phases.intensive}å¤© â†’ å†²åˆºæœŸ${plan.summary.phases.sprint}å¤©\n\n`;
            
            // æ·»åŠ æ¯æ—¥è®¡åˆ’
            exportContent += `ğŸ“… è¯¦ç»†è®­ç»ƒå®‰æ’:\n`;
            exportContent += `-------------------\n\n`;
            
            plan.dailyPlan.forEach(day => {
                exportContent += `ç¬¬${day.day}å¤© (${day.date}) - ${day.phase}`;
                if (day.rest) exportContent += ` [ä¼‘æ¯æ—¥]`;
                exportContent += `\n`;
                
                day.training.forEach(item => {
                    exportContent += `  â€¢ ${item.item} (${item.duration}, ${item.intensity}${item.detail ? ', ' + item.detail : ''})\n`;
                });
                exportContent += `\n`;
            });
            
            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const blob = new Blob([exportContent], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ä½“æµ‹è®­ç»ƒè®¡åˆ’_${new Date().toLocaleDateString()}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('è®­ç»ƒè®¡åˆ’å·²å¯¼å‡ºï¼');
        }

        function printTrainingPlan() {
            const plan = JSON.parse(localStorage.getItem('trainingPlan'));
            if (!plan) {
                alert('æ²¡æœ‰å¯æ‰“å°çš„è®­ç»ƒè®¡åˆ’ï¼');
                return;
            }
            
            // åˆ›å»ºæ‰“å°çª—å£
            const printWindow = window.open('', '_blank', 'width=800,height=600');
            
            let printContent = `
                <html>
                <head>
                    <title>ä½“æµ‹è®­ç»ƒè®¡åˆ’</title>
                    <style>
                        body { font-family: 'Microsoft YaHei', Arial, sans-serif; margin: 20px; }
                        .header { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; text-align: center; }
                        .section { background: #f7fafc; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
                        .day-plan { background: white; padding: 10px; margin-bottom: 8px; border-radius: 6px; border-left: 4px solid #4facfe; }
                        .rest-day { border-left-color: #48bb78; background: #f0fff4; }
                        @media print { body { margin: 10px; } .no-print { display: none; } }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>ğŸƒâ€â™‚ï¸ ä¸ªæ€§åŒ–ä½“æµ‹è®­ç»ƒè®¡åˆ’</h1>
                        <p>æˆç»©ç›®æ ‡: ${plan.summary.currentScore}åˆ† â†’ ${plan.summary.targetScore}åˆ† | è®­ç»ƒå‘¨æœŸ: ${plan.summary.totalDays}å¤©</p>
                    </div>
            `;
            
            // æ·»åŠ æ¯æ—¥è®¡åˆ’
            printContent += `<div class="section"><h2>ğŸ“… è¯¦ç»†è®­ç»ƒå®‰æ’</h2>`;
            
            plan.dailyPlan.forEach(day => {
                printContent += `
                    <div class="day-plan ${day.rest ? 'rest-day' : ''}">
                        <strong>ç¬¬${day.day}å¤© (${day.date}) - ${day.phase}${day.rest ? ' [ä¼‘æ¯æ—¥]' : ''}</strong><br>
                `;
                
                day.training.forEach(item => {
                    printContent += `â€¢ ${item.item} (${item.duration}, ${item.intensity}${item.detail ? ', ' + item.detail : ''})<br>`;
                });
                
                printContent += `</div>`;
            });
            
            printContent += `
                    </div>
                    <div class="no-print" style="text-align: center; margin-top: 20px;">
                        <button onclick="window.print()" style="background: #4facfe; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">ğŸ–¨ï¸ æ‰“å°</button>
                        <button onclick="window.close()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-left: 10px;">å…³é—­</button>
                    </div>
                </body>
                </html>
            `;
            
            printWindow.document.write(printContent);
            printWindow.document.close();
        }

        // ä¿å­˜è®­ç»ƒè®¡åˆ’å†å²è®°å½•
        function saveTrainingPlanHistory(plan) {
            const history = JSON.parse(localStorage.getItem('trainingPlanHistory') || '[]');
            const newPlan = {
                id: Date.now(),
                createdAt: new Date().toLocaleString(),
                summary: plan.summary,
                dailyPlan: plan.dailyPlan.slice(0, 7) // åªä¿å­˜å‰7å¤©çš„è¯¦ç»†ä¿¡æ¯
            };
            
            history.unshift(newPlan); // æœ€æ–°è®¡åˆ’åœ¨å‰
            
            // åªä¿ç•™æœ€è¿‘10ä¸ªè®¡åˆ’
            if (history.length > 10) {
                history.splice(10);
            }
            
            localStorage.setItem('trainingPlanHistory', JSON.stringify(history));
        }

        // æ˜¾ç¤ºè®­ç»ƒè®¡åˆ’å†å²
        function showTrainingPlanHistory() {
            const history = JSON.parse(localStorage.getItem('trainingPlanHistory') || '[]');
            
            if (history.length === 0) {
                alert('æš‚æ— è®­ç»ƒè®¡åˆ’å†å²è®°å½•ï¼');
                return;
            }
            
            let historyContent = `
                <div style="max-width: 600px; margin: 0 auto; background: white; border-radius: 15px; padding: 25px;">
                    <h2 style="color: #2d3748; margin-bottom: 20px; text-align: center;">ğŸ“š è®­ç»ƒè®¡åˆ’å†å²</h2>
                    <div style="max-height: 400px; overflow-y: auto;">
            `;
            
            history.forEach(plan => {
                historyContent += `
                    <div style="background: #f7fafc; padding: 15px; margin-bottom: 15px; border-radius: 10px; border-left: 4px solid #4facfe;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <strong style="color: #2d3748;">${plan.createdAt}</strong>
                            <span style="background: #4facfe; color: white; padding: 4px 12px; border-radius: 15px; font-size: 0.9em;">
                                ${plan.summary.totalDays}å¤©è®¡åˆ’
                            </span>
                        </div>
                        <div style="color: #4a5568; margin-bottom: 8px;">
                            æˆç»©ç›®æ ‡: ${plan.summary.currentScore}åˆ† â†’ ${plan.summary.targetScore}åˆ†
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="loadTrainingPlan(${plan.id})" style="background: #4facfe; color: white; border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; font-size: 0.9em;">
                                åŠ è½½è®¡åˆ’
                            </button>
                            <button onclick="deleteTrainingPlan(${plan.id})" style="background: #dc3545; color: white; border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; font-size: 0.9em;">
                                åˆ é™¤
                            </button>
                        </div>
                    </div>
                `;
            });
            
            historyContent += `
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button onclick="document.getElementById('historyModal').remove()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                            å…³é—­
                        </button>
                    </div>
                </div>
            `;
            
            // åˆ›å»ºæ¨¡æ€æ¡†
            const modal = document.createElement('div');
            modal.id = 'historyModal';
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); z-index: 1000; display: flex; 
                align-items: center; justify-content: center;
            `;
            modal.innerHTML = historyContent;
            
            document.body.appendChild(modal);
            
            // ç‚¹å‡»èƒŒæ™¯å…³é—­
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // åŠ è½½å†å²è®­ç»ƒè®¡åˆ’
        function loadTrainingPlan(planId) {
            const history = JSON.parse(localStorage.getItem('trainingPlanHistory') || '[]');
            const plan = history.find(p => p.id === planId);
            
            if (plan) {
                // ä»å®Œæ•´è®¡åˆ’ä¸­æ¢å¤
                const fullPlan = JSON.parse(localStorage.getItem('trainingPlan'));
                if (fullPlan && fullPlan.summary.createdAt === plan.createdAt) {
                    displayTrainingPlan(fullPlan);
                    document.getElementById('historyModal').remove();
                    document.getElementById('trainingResults').scrollIntoView({ behavior: 'smooth' });
                } else {
                    alert('æ— æ³•åŠ è½½å®Œæ•´çš„è®­ç»ƒè®¡åˆ’ï¼Œè¯·é‡æ–°ç”Ÿæˆï¼');
                }
            }
        }

        // åˆ é™¤å†å²è®­ç»ƒè®¡åˆ’
        function deleteTrainingPlan(planId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè®­ç»ƒè®¡åˆ’å—ï¼Ÿ')) {
                let history = JSON.parse(localStorage.getItem('trainingPlanHistory') || '[]');
                history = history.filter(p => p.id !== planId);
                localStorage.setItem('trainingPlanHistory', JSON.stringify(history));
                showTrainingPlanHistory(); // åˆ·æ–°å†å²è®°å½•æ˜¾ç¤º
            }
        }
    </script>
    </script>
    
    <!-- é¡µè„šç‰ˆæƒä¿¡æ¯ -->
    <div style="text-align: center; padding: 20px; color: rgba(255,255,255,0.8); font-size: 14px;">
        &copy; 2025 å‘¨ç¼éœ– 1328940285@qq.com
    </div>
</body>
</html>
</body>
</html>

